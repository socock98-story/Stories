---
layout: base
---
{%- assign s = site.stories | where: 'slug', page.story | first -%}

{%- assign current = page.chapter | plus: 0 -%}
{%- assign prev_num = current | minus: 1 -%}
{%- assign next_num = current | plus: 1 -%}

{%- assign siblings = site.chapters | where: 'story', page.story -%}

{%- assign prev_ch = siblings | where: 'chapter', prev_num | first -%}
{%- assign next_ch = siblings | where: 'chapter', next_num | first -%}

{%- if prev_ch and prev_ch.url == page.url -%}{%- assign prev_ch = nil -%}{%- endif -%}
{%- if next_ch and next_ch.url == page.url -%}{%- assign next_ch = nil -%}{%- endif -%}

<article class="chapter">
  <header class="chapter-header">
    <h1 class="story-title">{{ s.title }}</h1>
    {%- if s.type == "series" -%}<h2 class="chapter-num">Chapter {{ page.chapter }}</h2>{%- endif -%}
    <div class="pill-row">
      {%- if s.genre -%}<span class="pill genre">{{ s.genre }}</span>{%- endif -%}
      {%- for tag in s.tags -%}<span class="pill tag">{{ tag }}</span>{%- endfor -%}
    </div>
  </header>

  <div class="prose">
    {{ content }}
  </div>

  {% if s.type == "one-shot" %}
    <nav class="chapter-nav single">
      <a class="button ghost" href="{{ '/' | relative_url }}">Back to home</a>
    </nav>
  {% else %}
    <nav class="chapter-nav">
      {% if prev_ch %}
        <a class="button" href="{{ prev_ch.url | relative_url }}" rel="prev">← Previous</a>
      {% else %}
        <span class="button disabled">← Previous</span>
      {% endif %}
  
      <a class="button ghost" href="{{ s.url | relative_url }}">Back to story</a>
  
      {% if next_ch %}
        <a class="button" href="{{ next_ch.url | relative_url }}" rel="next">Next →</a>
      {% else %}
        <span class="button disabled">Next →</span>
      {% endif %}
    </nav>
  {% endif %}
</article>
